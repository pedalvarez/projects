<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.

-->
<html>
    <head>
        <title>Get Shopping Carts</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="js/jquery-1.11.2.js"></script>
        <script language="JavaScript">

        var table = "<tr><th>Product</th><th>attribute</th><th>value</th></tr>";

        function GetShopingCarts() {
             $.ajax({
                url: 'http://127.0.0.1/GetShopingCarts.php', // location of your php script
                type: 'POST',
                data: { "getShoppingCarts": ""},
                datatype:"JSON",
                //asynch: false,
                error: function (xhr, textStatus, errorThrown) { alert(xhr + ' ' + textStatus + '' + errorThrown) },
                success: function (response) {
                    //document.getElementById("result").innerHTML = "Shopping Carts:" + response;
                    $("select[name='cname'] option").remove();
                    var data = $.parseJSON(response);
                    $.each(data, function(i, post) {
                        $("<option>" + post.Id + "</option>").appendTo($("select[name='cname']"));                                             
                    });                    
                    // mark the first option as selected
                    $("select[name='cname']").change();
                }
            });
        }
 
        function AddCustomAttrs(data,level){
            if(data != null)
            $.each(data, function(i, attr) {
                table = table + "<tr>";
                table = table + "<td></td>";
                table = table + "<td></td>";
                for(i=0;i<level;i++){
                    table = table + "<td></td>";
                }
                table = table + "<table>";
                table = table + "<th>name</th><th>value</th>";
                table = table + "<tr>";
                table = table + "<td></td>";
                table = table + "<td></td>";
                for(i=0;i<level;i++){
                    table = table + "<td></td>";
                }
                table = table + "<td>" + attr.name + "</td>";
                table = table + "<td>" + attr.value + "</td>";
                table = table + "</tr>";
                table = table + "</table>";
                table = table + "</tr>";
                AddCustomAttrs(attr.Attribute, level + 1);
            });              
        }
        
        $(document).ready(function() {            
                $cname = $("select[name='cname']");

                $cname.change(function() {
                    var id = $(this).val();
                    console.log("current cart: " + id);
                    
                    // Get User from Cart ID
                    $.ajax({
                        url: 'http://127.0.0.1/GetUserFromCartId.php', // location of your php script  
                        type: 'POST',
                        data: { "getUserByCartId": "", "id": id},                              
                        datatype:"JSON",
                        //asynch: false,
                        error: function (xhr, textStatus, errorThrown) { alert(xhr + ' ' + textStatus + '' + errorThrown) },
                        success: function (response) {
                            var data = $.parseJSON(response);

                            document.getElementById("CustomerName").innerHTML = "Customer name: " + data.name; 
                            document.getElementById("Address").innerHTML = "Address: " + data.Address; 
                            document.getElementById("Organization").innerHTML = "Organization: " + data.OrgName; 
                        }
                    });
                    
                    // reset table
                    table = "<tr><th>Product</th><th>attribute</th><th>value</th></tr>";
                    // Get Products from Cart ID
                    $.ajax({
                        url: 'http://127.0.0.1/GetProductsFromCartId.php', // location of your php script
                        type: 'POST',
                        data: { "getProductsFromCartId": "", "id": id},
                        datatype:"JSON",
                        //asynch: false,
                        error: function (xhr, textStatus, errorThrown) { alert(xhr + ' ' + textStatus + '' + errorThrown) },
                        success: function (response) {
                            //document.getElementById("result2").innerHTML = response;
                            var data = $.parseJSON(response);
                            $.each(data, function(i, post) {
                                table = table + "<tr><td>" + post.name + "</td>";
                                $.each(post.attributes, function(i, attr) {
                                    table = table + "<tr>";
                                    table = table + "<td></td>";
                                    table = table + "<td>" + attr.name + "</td>";
                                    table = table + "<td>" + attr.value + "</td>";
                                    table = table + "</tr>";
                                    AddCustomAttrs(attr.Attribute,0);
                                });
                                table = table + "</tr>";
                            });
                            document.getElementById("table").innerHTML = table;
                        }
                    });
                });
        });
        </script>     
    </head>
    <body>
      <form name="DemoForm">
         <button onclick="GetShopingCarts()">Get Shopping Carts</button>
         <!-- <p id="result">Result:</p> -->
         <p></p>
         <p>Shopping Carts:</p> 
         <select name="cname">
            <option>None</option>
         </select>
         <p></p>
         <p id="CustomerName">Customer name: </p> 
         <p></p>
         <p id="Address">Address: </p>
         <p></p>
         <p id="Organization">Organization: </p> 
         <p></p>
         <!-- <p id="result2">Result:</p> --> 
         <table id="table" border="1">
         </table>
         <div>
          <a href="index.html">Back</a>
         </div>
      </form>
     </body>
</html>
